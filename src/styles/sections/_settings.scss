@use '../base/variables' as *;
@use 'sass:map';

// Settings SCSS — CLEARED STARTER
// This file intentionally minimal: we'll rebuild from scratch, section-by-section.
// Keep the page-level grid small and let components provide visuals; avoid
// global overrides until we add precise rules required by the layout.


#settings-view {
  padding: map.get($spacing, 6);
  min-height: calc(100vh - 120px);
  box-sizing: border-box;

  .settings-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: map.get($spacing, 4);
    padding-bottom: map.get($spacing, 4);
    margin-bottom: map.get($spacing, 6);
    border-bottom: 1px solid var(--gray-100);

    h1 { margin: 0; font-size: map.get($font-sizes, 3xl); font-weight: map.get($font-weights, bold); color: var(--primary-blue); }
    p  { margin: 0; color: var(--gray-600); max-width: 56ch; opacity: 0.9; }
  }

  .settings-container { max-width: var(--app-max-width, 1600px); width: 100%; margin: 0 auto; }

  // Safety clamp for any inner grids inside the settings view: do not allow
  // auto-fit or extra columns to produce 3+ narrow columns. Keep a readable
  // two-column layout only (opt-in internals can still use .section-content--cols)
  .settings-container :is(.timer-stats, .timers-container, .step-type-selector, .metrics-grid, .metrics-dashboard, .filter-grid, .insights-dashboard, .scripts-grid, .task-board) {
    grid-template-columns: repeat(2, minmax(320px, 1fr)) !important;
  }

  .settings-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(320px, 1fr));
    gap: map.get($spacing, 6);
    align-items: start;

    // keep the 3rd item full-width by default
    > .settings-section:nth-child(3) { grid-column: 1 / -1; }
  }

  @media (max-width: map.get($breakpoints, sm)) {
    .settings-grid { grid-template-columns: 1fr; }
    .settings-header { flex-direction: column; align-items: flex-start; }
  }

  // Base section visuals — preserve the main-page look and spacing.
  // Visual surface comes from shared `.card` components; keep these rules
  // structural only (padding, stacked content default, optional multi-column).

  .settings-section {
    .section-header {
      padding: map.get($spacing, 4);
      background: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      gap: map.get($spacing, 3);
      align-items: center;
    }

    .section-header .title-container { flex: 1; }

    .section-header .section-title {
      margin: 0;
      padding: 0;
      display: block;
      width: 100%;
      box-sizing: border-box;
      color: var(--text);
      font-size: map.get($font-sizes, lg);
      font-weight: map.get($font-weights, semibold);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .section-content {
      padding: map.get($spacing, 6);
      display: grid;
      grid-template-columns: 1fr; // single column by default
      gap: map.get($spacing, 4);
    }

    // allow an optional section-level heading appearance (rare)
    > h3 { margin: 0 0 map.get($spacing, 2) 0; padding: map.get($spacing, 4); background: var(--card-bg); border-bottom: 1px solid var(--border-color); color: var(--primary-blue); }
  }

  // Default: keep known inner-grids single column inside Settings unless explicitly opted in
  .section-content .toggle-grid,
  .section-content .export-options,
  .section-content .appearance-grid,
  .section-content .pattern-management,
  .section-content .theme-buttons,
  .section-content .metrics-grid,
  .section-content .timer-stats,
  .section-content .form-row {
    grid-template-columns: 1fr !important;
    gap: map.get($spacing, 3) !important;
  }

  // When a section opts into multi-column internals use the modifier
  .section-content.section-content--cols .toggle-grid,
  .section-content.section-content--cols .pattern-management,
  .section-content.section-content--cols .export-options,
  .section-content.section-content--cols .appearance-grid,
  .section-content.section-content--cols .theme-buttons,
  .section-content.section-content--cols .metrics-grid,
  .section-content.section-content--cols .timer-stats,
  .section-content.section-content--cols .form-row {
    grid-template-columns: repeat(2, minmax(240px, 1fr)) !important;
  }

  // Per-section specifics removed — keep this file focused on global
  // settings layout and general rules only. Per-section visuals should live
  // with component/section styles (e.g., _patterns.scss, _forms.scss).

  // Settings subsection styling
  .settings-subsection {
    background: linear-gradient(135deg, var(--surface), var(--bg));
    border: 1px solid var(--border-color);
    border-radius: map.get($radius, lg);
    padding: map.get($spacing, 4);
    margin: map.get($spacing, 4) 0;

    h4 {
      margin: 0 0 map.get($spacing, 3) 0;
      color: var(--text);
      font-size: map.get($font-sizes, lg);
      font-weight: map.get($font-weights, semibold);
    }
  }

  // Special styling for Export Options
  .export-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: map.get($spacing, 3);
    margin-top: map.get($spacing, 2);

    .export-option {
      display: flex;
      align-items: center;
      padding: map.get($spacing, 2);
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: map.get($radius, base);
      transition: map.get($transitions, base);

      &:hover {
        border-color: var(--primary-blue);
        background: var(--surface);
      }

      input[type="checkbox"] {
        margin-right: map.get($spacing, 2);
        accent-color: var(--primary-blue);
      }

      label {
        font-size: map.get($font-sizes, sm);
        color: var(--text);
        cursor: pointer;
        margin: 0;
      }
    }
  }

  // Special styling for CRM Connection
  .crm-connection-item {
    .setting-label {
      color: var(--primary-blue);
      font-weight: map.get($font-weights, semibold);
    }

    .setting-description {
      color: var(--text-muted);
    }

    .setting-control {
      .button {
        background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
        color: white;
        border: none;
        padding: map.get($spacing, 2) map.get($spacing, 4);
        border-radius: map.get($radius, base);
        font-weight: map.get($font-weights, medium);
        transition: map.get($transitions, base);

        &:hover {
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
        }
      }
    }
  }
}
